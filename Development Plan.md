# 桌台实时累加系统（本地版）
## Development Plan / 开发计划（V1.0）

---

## 1. 项目范围（Scope）

### 1.1 当前版本目标
- 单机客户端（Local-only）
- 本地数据存储（无云端、无账号）
- 以「桌台」为中心的实时消费累加
- 适配 **平板优先 + 手机可用**
- 面向忙场景、低学习成本
-界面美观、操作简单

### 1.2 明确不做（V1 不包含）
- ❌ 语音识别
- ❌ 云同步 / 登录
- ❌ 多设备实时协作
- ❌ 复杂报表 / 财务系统
- ❌ 会员 / 营销 / POS 对接

---

## 2. 核心设计原则

1. **桌台即账本**
2. **所有操作 = 累加 / 减少**
3. **无填写表单**
4. **一步操作可完成**
5. **所有操作可撤销**
6. **离线优先，稳定第一**

---

## 3. 功能模块拆解

---

### 3.1 桌台管理（Table Module）

#### 功能
- 桌台列表展示（1号桌、2号桌…）
- 显示每桌：
  - 当前金额
  - 使用状态（空闲 / 用餐中）
- 新开桌 / 清台

#### 关键点
- 字体大
- 一屏尽量展示所有桌
- 点击即进入桌台详情

---

### 3.2 桌台内实时累加（核心模块）

#### 功能
- 桌台内展示商品快捷卡片
- 支持多次加项 / 减项
- 即时更新数量与金额
- 无确认弹窗

#### 操作方式
- `+ / -` 大按钮
- 默认步长（如：可乐 +1瓶）

---
### 3.2.1 [新增] 语音暂存功能（忙碌场景兜底）

#### 痛点解决
- 解决高峰期来不及低头看屏幕、不仅无法打字甚至无法准确点击的问题。

#### 功能逻辑
1. **长按录音**：
   - 界面底部常驻巨大的“按住说话”按钮。
   - 按下时震动反馈，屏幕变红提示“正在录音”。
   - 松手即保存。
2. **待办提示（红点）**：
   - 该桌台卡片上出现明显的“🔴 未处理录音”标记。
3. **空闲处理**：
   - 点击红点 -> 播放录音（如：“5号桌加个娃娃菜”） -> 操作员手动点击 +1。
   - 操作完成后，可一键删除录音（或转为已处理）。

---

### 3.2.2 [新增] 称重商品专用键盘（Numeric Keypad）

#### 痛点解决
- 解决“酸菜鱼”等非标品（3.5kg、2.8斤）无法通过“+1”按钮记录的问题。

#### 交互逻辑
1. **触发方式**：
   - 点击“称重类”商品（如：招牌酸菜鱼）时，**不**直接 +1。
   - 而是弹出一个半屏高的**大号数字键盘**（类似计算器布局）。
2. **键盘布局**：
   - 数字键（0-9）超大尺寸。
   - 包含小数点 `.`。
   - 包含常用快捷键（如：2斤、2.5斤、3斤）。
3. **确认机制**：
   - 输入数字（如 `3.5`）-> 点击巨大的“确认”键 -> 记录生效。
   - 包含“单位”显示（默认读取商品属性，如 kg/斤）。
   
### 3.3 商品与单位管理

#### 商品属性
- 名称（如：酸菜鱼、可乐）
- 单位（kg / 瓶 / 碗）
- 单价
- 默认步长（0.5 / 1 / 自定义）
-可自定义添加商品

#### 分类（仅用于展示）
- 称重类
- 计数类

---

### 3.4 结账与校对

#### 功能
- 显示该桌完整明细
- 单项数量可修改
- 自动计算总价
- 一键结账并清空桌台

#### 设计原则
> 结账 = 最终校对，而不是重新算账

---

### 3.5 操作日志与撤销（防错）

#### 功能
- 每次加/减都记录日志
- 支持撤销最近操作
- 防止误触、漏记

---

## 4. 页面结构（Information Architecture）

桌台列表页（Home）
├─ 桌台详情页（Table Detail）
│ ├─ 商品累加区
│ ├─ 当前金额展示
│ └─ 结账入口
├─ 商品管理页（Items）
└─ 设置页（Settings）

---

## 5. 数据模型设计（本地）

### 5.1 Tables（桌台）

| 字段 | 类型 | 说明 |
|----|----|----|
| table_id | int | 桌号 |
| status | string | idle / in_use |
| created_at | timestamp | 开桌时间 |
| updated_at | timestamp | 最近操作 |

---

### 5.2 Items（商品）

| 字段 | 类型 | 说明 |
|----|----|----|
| item_id | string | 唯一ID |
| name | string | 名称 |
| unit | string | 单位 |
| price | float | 单价 |
| step | float | 默认步长 |

---

### 5.3 Table_Items（桌台明细）

| 字段 | 类型 | 说明 |
|----|----|----|
| table_id | int | 桌号 |
| item_id | string | 商品 |
| quantity | float | 数量 |
| updated_at | timestamp | 最近变更 |

---

### 5.4 Ops_Log（操作日志）

| 字段 | 类型 | 说明 |
|----|----|----|
| id | int | 主键 |
| table_id | int | 桌号 |
| item_id | string | 商品 |
| delta | float | 增减值 |
| timestamp | timestamp | 时间 |

---

## 6. 技术选型

### 6.1 客户端
- Flutter（推荐）
- 平板优先，自适应手机

### 6.2 本地存储
- SQLite
- 事务写入（防并发误写）

### 6.3 状态管理
- 本地状态为主
- 页面切换不丢数据

### 6.4 UI 组件库
-需自定义 NumericKeyboard Widget（不使用系统自带键盘，防止太小误触）。

### 6.5 音频处理
-引入 flutter_sound 或类似库，实现本地音频文件的录制与即播即删。

---

## 7. 开发阶段规划（MVP → 稳定版）

---

### Phase 1：MVP（第 1–2 周）

- 桌台列表页
- 桌台详情页
- 商品累加（+ / -）
- 本地 SQLite 存储
- 一键结账清台

**目标**：能真实跑在餐馆

---

### Phase 2：防错与可用性（第 3 周）

- 操作日志
- 撤销功能
- 数量异常校验
- UI 放大 / 对比优化

---

### Phase 3：可维护性（第 4 周）

- 商品管理页面
- 设置默认步长
- 本地数据导出（CSV / JSON）
- 代码结构整理

---

## 8. 后续可扩展方向（不在当前 Scope）

- 语音快捷加项（ASR + 规则解析）
- 多设备同步（局域网 / 云）
- 打印小票
- POS 对接
- 数据统计报表

---

## 9. 验收标准（Definition of Done）

- 忙场景下 1 秒内完成一次加菜
- 无需教学即可上手
- 连续操作不丢数据
- 误触可撤销
- 一天营业结束无漏记

---

## 10. 当前开发优先级（Checklist）

- [ ] 桌台列表页
- [ ] 桌台详情累加逻辑
- [ ] 商品模型
- [ ] SQLite 表结构
- [ ] 结账流程
- [ ] 操作日志 & 撤销

---
